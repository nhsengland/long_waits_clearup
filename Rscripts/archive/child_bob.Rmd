---
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

OUH {data-navmenu="BOB"}
====================================== 

```{r t1-setup, include=FALSE}
trust <-  'OXFORD UNIVERSITY HOSPITALS NHS FOUNDATION TRUST'

cp <- current_position %>% 
  filter(est_position_at_deadline > 0) %>% 
  filter(organisation_name == trust)

admitted_projections <- cp %>% 
  filter(wait_type == 'DTA_Wait') %>% 
  select(tfc_name, 
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

op_projections <- cp %>% 
  filter(wait_type == 'OP_Wait')%>% 
  select(tfc_name,
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

total_dta_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='DTA_Wait') %>% 
  pull(total_specs)

total_op_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='OP_Wait') %>% 
  pull(total_specs)

dta_breach_specs <- nrow(admitted_projections)
op_breach_specs <- nrow(op_projections)

```


Column {data-width=700}
-----------------------------------------------------------------------

### Admitted specialities - projected breaches

```{r t1-admitted projections}

fn_projections_dt(admitted_projections)

```

### Non-Admitted specialities - projected breaches

```{r t1-outpatient projections}

fn_projections_dt(op_projections)

```

Column {data-width=300}
-----------------------------------------------------------------------

### Percentage of admitted specialities with projected long waits after deadline 

```{r t1-valuebox-admitted}

valueBox(round(dta_breach_specs/total_dta_specs*100,1), icon = 'fa-percent')

```

### admitted long waits by week 

``` {r t1-apc-trend}

apc_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'DTA_Wait')

ggplotly(apc_lw_trend)


```


### Percentage of non-admitted specialities with projected long waits after deadline 

```{r t1-valuebox-nonadmitted}

valueBox(round(op_breach_specs/total_op_specs*100,1), icon = 'fa-percent')

```

### outpatient long waits by week

``` {r t1-op-trend}
op_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'OP_Wait')

ggplotly(op_lw_trend)
```

RBH {data-navmenu="BOB"}
====================================== 

```{r t2-setup, include=FALSE}
trust <-  'ROYAL BERKSHIRE NHS FOUNDATION TRUST'

cp <- current_position %>% 
  filter(est_position_at_deadline > 0) %>% 
  filter(organisation_name == trust)

admitted_projections <- cp %>% 
  filter(wait_type == 'DTA_Wait') %>% 
  select(tfc_name, 
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

op_projections <- cp %>% 
  filter(wait_type == 'OP_Wait')%>% 
  select(tfc_name,
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

total_dta_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='DTA_Wait') %>% 
  pull(total_specs)

total_op_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='OP_Wait') %>% 
  pull(total_specs)

dta_breach_specs <- nrow(admitted_projections)
op_breach_specs <- nrow(op_projections)

```


Column {data-width=700}
-----------------------------------------------------------------------

### Admitted specialities - projected breaches

```{r t2-admitted projections}

fn_projections_dt(admitted_projections)

```

### Non-Admitted specialities - projected breaches

```{r t2-outpatient projections}

fn_projections_dt(op_projections)

```

Column {data-width=300}
-----------------------------------------------------------------------

### Percentage of admitted specialities with projected long waits after deadline 

```{r t2-valuebox-admitted}

valueBox(round(dta_breach_specs/total_dta_specs*100,1), icon = 'fa-percent')

```

### admitted long waits by week 

``` {r t2-apc-trend}

apc_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'DTA_Wait')

ggplotly(apc_lw_trend)


```


### Percentage of non-admitted specialities with projected long waits after deadline 

```{r t2-valuebox-nonadmitted}

valueBox(round(op_breach_specs/total_op_specs*100,1), icon = 'fa-percent')

```

### outpatient long waits by week

``` {r t2-op-trend}
op_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'OP_Wait')

ggplotly(op_lw_trend)
```

BHT {data-navmenu="BOB"}
====================================== 

```{r t3-setup, include=FALSE}
trust <-  'BUCKINGHAMSHIRE HEALTHCARE NHS TRUST'

cp <- current_position %>% 
  filter(est_position_at_deadline > 0) %>% 
  filter(organisation_name == trust)

admitted_projections <- cp %>% 
  filter(wait_type == 'DTA_Wait') %>% 
  select(tfc_name, 
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

op_projections <- cp %>% 
  filter(wait_type == 'OP_Wait')%>% 
  select(tfc_name,
         current_ptl,
         current_long_waits,
         est_position_at_deadline,
         change_trend) %>% 
  arrange(desc(est_position_at_deadline))

total_dta_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='DTA_Wait') %>% 
  pull(total_specs)

total_op_specs <-  specs_per_org %>% 
  filter(organisation_name == trust &
           wait_type=='OP_Wait') %>% 
  pull(total_specs)

dta_breach_specs <- nrow(admitted_projections)
op_breach_specs <- nrow(op_projections)

```


Column {data-width=700}
-----------------------------------------------------------------------

### Admitted specialities - projected breaches

```{r t3-admitted projections}

fn_projections_dt(admitted_projections)

```

### Non-Admitted specialities - projected breaches

```{r t3-outpatient projections}

fn_projections_dt(op_projections)

```

Column {data-width=300}
-----------------------------------------------------------------------

### Percentage of admitted specialities with projected long waits after deadline 

```{r t3-valuebox-admitted}

valueBox(round(dta_breach_specs/total_dta_specs*100,1), icon = 'fa-percent')

```

### admitted long waits by week 

``` {r t3-apc-trend}

apc_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'DTA_Wait')

ggplotly(apc_lw_trend)


```


### Percentage of non-admitted specialities with projected long waits after deadline 

```{r t3-valuebox-nonadmitted}

valueBox(round(op_breach_specs/total_op_specs*100,1), icon = 'fa-percent')

```

### outpatient long waits by week

``` {r t3-op-trend}
op_lw_trend<- fn_lw_trend(full_long_wait_data,trust,'OP_Wait')

ggplotly(op_lw_trend)
```

